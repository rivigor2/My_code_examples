# GoCPA.Cloud

[Боевая площадка облака (ветка master)](https://gocpa.cloud/)
[Боевая площадка пп#1 (ветка master)](https://test.gocpa.cloud/)

[Дев площадка (ветка develop)](https://dev.gocpa.cloud/)
[Дев площадка пп#1 (ветка develop)](https://test.dev.gocpa.cloud/)

## Установка проекта

```console
# Клонируем проект
git clone git@bitbucket.org:gocpa/cloud.git
# Устанавливаем зависимости
composer install
# Копируем .env.example в .env
php -r "file_exists('.env') || copy('.env.example', '.env');"

# В файле .env необходимо прописать доступы от бд

# Генерируем ключик
php artisan key:generate --ansi

# Мигрируем
php artisan migrate:fresh --seed
```

## Порядок работы

* Задачи на данный момент делятся на два типа «feature» и «task». Фича - это большинство задач, которые делаются по проекту и ожидают скорой выкладки. Таск - долгая (или требующая тестирования на деве) задача. В трекере о создании данной задачи будет отдельная отметка (либо решается программистом)
* Для таска: создаем ветку по номеру задачи с названием `tasks/1234`, наследуем её от ветки `develop`
* Для фичи: создаем ветку по номеру задачи с названием `feature/1234`, наследуем её от ветки `master`
* Выполняем работу
* Если был затронут функционал, затронутый автотестом - тест корректируется.
* Запускаем автотесты ```php artisan test```, удостоверяемся, что ничего не сломалось. С поваленными тестами коммитить запрещено (за исключением ГЛОБАЛЬНОЙ ЖОПЫ, в данном случае в commit-message необходимо написать об этом)
* Создаем pull-request в ветку, от которой было наследование
* Переводим задачу в RT в статус "Pull-реквест"
* Если код-ревью пройдено успешно, pull-request принимается, 
* Ревьюер переводит задачу на детальную проверку тестировщику задачи

**В ветки master/develop не коммитим, только мержим другие ветки!**

## Проверка кода и стиля написания

### Автоматическое исправление код-стайла в выбранном файле

Хорошим тоном будет придерживаться единого код-стайла, поэтому перед коммитом запусти эту команду!

```console
# Исправить всю папку
vendor/bin/php-cs-fixer fix app/Http/Controllers/
```

```console
# Исправить один файл
vendor/bin/php-cs-fixer fix app/Http/Controllers/Partner/Controller.php
```

### Проверка кода на "гуано"

Волшебный анализатор, который показывает, есть ли в коде "странности"

```console
# Проверить весь проект
vendor/bin/phpstan analyze 
```

```console
# Проверить один файл
vendor/bin/phpstan analyze app/Http/Controllers/Partner/Controller.php
```

## Полезные команды

### Создание CRUD-контроллера

```console
php artisan make:controller:resource Advertiser/SomethingController [--model=Models/Something] [--force]
```

```--model``` Указывает на модель, с которой будем работать

```--force``` Создает контроллер, даже если он уже существует

Название контроллера указывается с указанием роли, в которой он будет находиться.

Команда вернет строку, которую будет нужно вставить в файл ```/routes/web_[role].php```

При заведении роутов **необходимо** придерживаться порядка роутов по алфавиту и **правильной вложенности**, для корректной работы меню

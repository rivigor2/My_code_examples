// GoCPA Cloud Pixel v1.2.4
!function(i,f,r){"use strict";function t(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function n(i){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,n,r;t=i,r=o[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})}return i}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var s={id:"",params:{},version:2},l=function(){function n(){u(this,n)}return c(n,null,[{key:"isPresent",value:function(e){return null!=e&&""!==e}},{key:"now",value:function(){return+new Date}},{key:"guid",value:function(){var t={};return location.search.substr(1).split("&").forEach(function(e){t[e.split("=")[0]]=e.split("=")[1]}),n.isPresent(t.gocpa_uid)?t.gocpa_uid:([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})}},{key:"optionalData",value:function(e){return!1===n.isPresent(e)?"":"object"===o(e)?n.optionalData(JSON.stringify(e)):"function"==typeof e?n.optionalData(e()):String(e)}},{key:"getDataLayer",value:function(){var n=[],e=JSON.stringify(i.dataLayer,function(e,t){if("object"===o(t)&&null!==t){if(n.includes(t))return;n.push(t)}return t}),n=null;return e}}]),n}(),m=function(){function e(){u(this,e)}return c(e,null,[{key:"nameAndVersion",value:function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}},{key:"isMobile",value:function(){return"ontouchstart"in f}},{key:"userAgent",value:function(){return i.navigator.userAgent}}]),e}(),g=function(){function e(){u(this,e)}return c(e,null,[{key:"prefix",value:function(){return"__".concat("gocpa","_")}},{key:"set",value:function(e,t,n,r){var i,o=3<arguments.length&&void 0!==r?r:"/",u="";l.isPresent(n)&&((i=new Date).setTime(i.getTime()+60*n*1e3),u="expires=".concat(i.toGMTString(),"; ")),f.cookie="".concat(this.prefix()).concat(e,"=").concat(t,"; ").concat(u,"path=").concat(o,"; SameSite=Lax")}},{key:"get",value:function(e){for(var e="".concat(this.prefix()).concat(e,"="),t=f.cookie.split(";"),n=0;n<t.length;n++){for(var r=t[n];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(e))return r.substring(e.length,r.length)}}},{key:"delete",value:function(e){this.set(e,"",-100)}},{key:"exists",value:function(e){return l.isPresent(this.get(e))}},{key:"setUtms",value:function(){for(var e=["utm_source","utm_medium","utm_term","utm_content","utm_campaign","click_id"],t=!1,n=0,r=e.length;n<r;n++)if(l.isPresent(p.getParameterByName(e[n]))){t=!0;break}if(t){for(var i,o={},n=0,r=e.length;n<r;n++)i=p.getParameterByName(e[n]),l.isPresent(i)&&(o[e[n]]=i);this.set("utm",JSON.stringify(o),43200)}}},{key:"getUtm",value:function(e){if(this.exists("utm")){var t=JSON.parse(this.get("utm"));return e in t?t[e]:""}}}]),e}(),p=function(){function e(){u(this,e)}return c(e,null,[{key:"getParameterByName",value:function(e,t){t=t||i.location.href,e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}},{key:"externalHost",value:function(e){return e.hostname!=location.hostname&&0===e.protocol.indexOf("http")}}]),e}(),y=function(){function r(e,t,n){u(this,r),this.params={},this.event=e,this.timestamp=t,this.optional=l.optionalData(n),this.buildParams(),this.send()}return c(r,[{key:"buildParams",value:function(){var e=this.getAttribute();for(var t in e)e.hasOwnProperty(t)&&this.setParam(t,e[t](t))}},{key:"getAttribute",value:function(){var e=this;return n({uid:function(){return g.get("uid")},ev:function(){return e.event},ed:function(){return e.optional},v:function(){return s.version},dl:function(){return i.location.href},rl:function(){return f.referrer},sr:function(){return i.screen.width+"x"+i.screen.height},vp:function(){return i.innerWidth+"x"+i.innerHeight},bn:function(){return m.nameAndVersion()},md:function(){return m.isMobile()},ua:function(){return m.userAgent()},tz:function(){return(new Date).getTimezoneOffset()},dataLayer:function(){return l.getDataLayer()},utm_source:function(e){return g.getUtm(e)},utm_medium:function(e){return g.getUtm(e)},utm_term:function(e){return g.getUtm(e)},utm_content:function(e){return g.getUtm(e)},utm_campaign:function(e){return g.getUtm(e)},click_id:function(e){return g.getUtm(e)}},s.params)}},{key:"setParam",value:function(e,t){l.isPresent(t)?this.params[e]=t:this.params[e]=null}},{key:"send",value:function(){i.navigator.sendBeacon?this.sendBeacon():this.sendImage()}},{key:"sendBeacon",value:function(){i.navigator.sendBeacon(s.id,JSON.stringify(this.params))}},{key:"sendImage",value:function(){console.error("pixel error: couldnt send object as image")}}]),r}();g.exists("uid")?g.set("uid",g.get("uid"),730):g.set("uid",l.guid(),730),g.setUtms(),r.process=function(e,t,n){"init"===e?s.id=t:"param"===e?s.params[t]=function(){return n}:"event"===e&&("pageload"!==t||s.pageLoadOnce?"pageload"!==t&&"pageclose"!==t&&new y(t,l.now(),n):(s.pageLoadOnce=!0,new y(t,r.t,n)))};for(var e=0,d=r.queue.length;e<d;e++)r.process.apply(r,r.queue[e]);i.onload=function(){if("function"==typeof URL)for(var e=["utm_source","utm_medium","utm_term","utm_content","utm_campaign","click_id"],t=f.querySelectorAll("a[data-gocpa-external-utm]"),n=0,r=t.length;n<r;n++){for(var i=new URL(t[n].href),o=i.searchParams,u=0;u<e.length;u++){var a=e[u],c=g.getUtm(a);c&&o.set(a,c)}o.set("gocpa_uid",g.get("uid")),i.search=o.toString();var s=i.toString();t[n].href=s,t[n].referrerPolicy="origin-when-cross-origin"}}}(window,document,window.gocpa);